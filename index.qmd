---
title: "Olympic Swimming Speed Trends Chart (1912-2020)"
author: "Paramanyu Gupta"
format:
  html:
    css: styles.css
    include-in-header:
      - text: |
          <link rel="preconnect" href="https://fonts.googleapis.com">
          <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
          <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
execute:
  echo: false
  message: false
  warning: false
---

```{r}
library(readr)
library(dplyr)
library(ggplot2)
library(stringr)
library(tidyr)
```

Have you ever wondered just how much faster Olympic swimmers have become over the decades, and what factors might be behind that incredible progress? To explore this, I've analyzed comprehensive Olympic swimming data spanning from 1912 to 2020, allowing me to examine average speed trends and visualize the global distribution of Olympic medals. Through this project, we've clearly seen how Olympic swimmers have consistently and substantially increased their average speeds over the last century, a powerful testament to continuous advancements in both technique and technology.

<br>

```{r}
# 1. Data Loading
df <- read_csv("data/olympic_swimming.csv")
```

```{r}
# 2. Data Cleaning/Transformation
distance_to_meters <- function(distance_str) {
  if (is.na(distance_str)) {
    return(NA_real_)
  }
  s <- tolower(as.character(distance_str))
  s <- str_replace_all(s, "m", "")
  s <- str_trim(s)

  if (str_detect(s, "x")) {
    return(NA_real_)
  }
  return(as.numeric(s))
}

time_to_seconds <- function(time_str) {
  if (is.na(time_str)) {
    return(NA_real_)
  }
  time_str <- str_trim(as.character(time_str))

  if (nchar(time_str) == 0 || grepl("[[:alpha:]]", time_str) || grepl(" ", time_str)) {
    return(NA_real_)
  }

  colon_count <- str_count(time_str, ":")

  if (colon_count == 2) {
    parts <- as.numeric(str_split(time_str, ":")[[1]])
    return(parts[1] * 3600 + parts[2] * 60 + parts[3])
  } else if (colon_count == 1) {
    parts <- as.numeric(str_split(time_str, ":")[[1]])
    return(parts[1] * 60 + parts[2])
  } else {
    return(as.numeric(time_str))
  }
}

df <- df %>%
  rowwise() %>%
  mutate(
    Distance_m = distance_to_meters(`Distance (in meters)`),
    time_sec = time_to_seconds(Results)
  ) %>%
  ungroup()
```

```{r}
# 3. Filtering and 4. Calculate Speed
df_cleaned <- df %>%
  filter(`Relay?` == 0) %>%
  drop_na(time_sec, Distance_m) %>%
  mutate(speed = Distance_m / time_sec)
```

```{r}
# 5. Aggregation
df_summary <- df_cleaned %>%
  group_by(Year, Gender) %>%
  summarise(speed = mean(speed, na.rm = TRUE)) %>%
  ungroup()
```

```{r, fig.width=16, fig.height=12}
# 6. Plotting (using ggplot2)
p <- ggplot(df_summary, aes(x = Year, y = speed, color = Gender)) +
  geom_line(aes(linetype = Gender), linewidth = 1) +
  geom_point(size = 2) +
  scale_color_manual(values = c("Men" = "#4A90E2", "Women" = "#E91E63")) +
  labs(
    x = "Year",
    y = "Average speed (m/s)",
    title = "Olympic Swimming: A Century of Speed and Performance",
    subtitle = "Driven by evolving techniques, technology, and dedication, speeds consistently improved."
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0, size = 25, margin = margin(t = 20, b = 10)),
    plot.subtitle = element_text(hjust = 0, size = 20, margin = margin(b = 20)),
    axis.title = element_text(size = 12,),
    legend.title = element_text(size = 17),
    legend.text = element_text(size = 15),
    panel.grid.major = element_line(linetype = "dashed", color = "gray"),
    panel.grid.minor = element_blank(),
    plot.margin = unit(c(2.5, 1, 2.5, 1), "cm") # Increased top and bottom margins for more space
  )

# Get y-axis limits from the data for relative positioning of annotations
min_y_data <- min(df_summary$speed, na.rm = TRUE)
max_y_data <- max(df_summary$speed, na.rm = TRUE)

# Calculate bottom annotation y-position based on plot height, adjusted to prevent cutoff
y_pos_bottom_annotations <- min_y_data + (max_y_data - min_y_data) * 0.05 # Increased from 0.02 to 0.05

# Add annotations (rectangles for shaded areas, vlines for dotted lines)
# Tech-suit Era & Ban (2008-2010)
p <- p + annotate("rect", xmin = 2008, xmax = 2010.5, ymin = -Inf, ymax = Inf,
                  fill = "gold", alpha = 0.15) +
  annotate("text", x = (2008 + 2010.5) / 2, y = y_pos_bottom_annotations,
           label = "Tech-suit Era & Ban (2008-2010)", angle = 90,
           vjust = 2.65, hjust = 0.285, color = "darkgoldenrod", size = 3)

# WWII (1939-1946)
p <- p + annotate("rect", xmin = 1939, xmax = 1946, ymin = -Inf, ymax = Inf,
                  fill = "red", alpha = 0.05) +
  annotate("text", x = 1942, y = y_pos_bottom_annotations,
           label = "WWII (1939-1946)", angle = 90,
           vjust = 0, hjust = 0.5, color = "darkred", size = 3)

# WWI (1914-1919)
p <- p + annotate("rect", xmin = 1914, xmax = 1919, ymin = -Inf, ymax = Inf,
                  fill = "blue", alpha = 0.05) +
  annotate("text", x = 1916, y = y_pos_bottom_annotations,
           label = "WWI (1914-1919)", angle = 90,
           vjust = 0, hjust = 0.5, color = "darkblue", size = 3)

# Widespread Goggle Use (from ~1970s)
p <- p + geom_vline(xintercept = 1972, linetype = "dotted", color = "darkblue", linewidth = 0.8) +
  annotate("text", x = 1972.5, y = max_y_data * 0.78,
           label = "Widespread Goggle Use (from ~1970s)", angle = 90,
           vjust = 1, hjust = 1.67, color = "darkblue", size = 3)

# Womenâ€™s debut (1912)
p <- p + geom_vline(xintercept = 1912, linetype = "dotdash", color = "pink", linewidth = 0.8) +
  annotate("text", x = 1912.5, y = max_y_data * 0.9,
           label = "Women's Debut (1912)", angle = 90,
           vjust = 1, hjust = 0, color = "deeppink", size = 3)

# Standardized Pools (from 1908)
p <- p + geom_vline(xintercept = 1908, linetype = "dotted", color = "purple", linewidth = 0.8) +
  annotate("text", x = 1908.5, y = max_y_data * 0.82,
           label = "Standardized Pools (from 1908)", angle = 90,
           vjust = 1, hjust = 0, color = "#663399", size = 3)

# Butterfly Introduction (1956)
p <- p + geom_vline(xintercept = 1956, linetype = "dotted", color = "darkgreen", linewidth = 0.8) +
  annotate("text", x = 1956.5, y = max_y_data * 0.70,
           label = "Butterfly Introduced (1956)", angle = 90,
           vjust = 1, hjust = 1.35, color = "darkgreen", size = 3)

# Backstroke Introduction (1900) - This section has been removed as per your request.


# 7. X-axis ticks modification (label every 10 years, starting from a clean decade)
p <- p + scale_x_continuous(breaks = seq(floor(min(df_summary$Year) / 10) * 10, ceiling(max(df_summary$Year) / 10) * 10, by = 10)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Explicitly print the plot object (Quarto will pick this up for display)
print(p)

# Save the plot to a file (optional, Quarto can also save plots automatically)
ggsave("olympic_swimming_trends_R.png", plot = p, width = 15, height = 8, units = "in")
```
